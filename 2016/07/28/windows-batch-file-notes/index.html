<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Windows Batch File Notes | I'm J2hongming</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">I'm J2hongming</a><span class="subtitle">Appreciate, respect and accept it, don't take it for granted</span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a><a href="/bookshelf" class="sidebar-nav-item">Bookshelf</a><a href="/toolbox" class="sidebar-nav-item">Toolbox</a><a href="https://www.linkedin.com/in/j2hongming/" class="sidebar-nav-item">About</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Windows Batch File Notes</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2016-07-28</div><div class="post-categories"><a class="post-category-link" href="/categories/windows/">windows</a>><a class="post-category-link" href="/categories/windows/bat/">bat</a></div></div></div><article><div class="container post"><ul>
<li>變數</li>
<li>if</li>
<li>導向</li>
<li>常用範例</li>
<li>參考資料<a id="more"></a>

</li>
</ul>
<h2 id="變數"><a href="#變數" class="headerlink" title="變數"></a>變數</h2><h3 id="系統變數"><a href="#系統變數" class="headerlink" title="系統變數"></a>系統變數</h3><pre><code>:: 觀察作業系統環境變數
set
:: 將作業系統環境變數輸出至variables.txt
set &gt; variables.txt</code></pre><h3 id="設定變數"><a href="#設定變數" class="headerlink" title="設定變數"></a>設定變數</h3><h4 id="基本設定"><a href="#基本設定" class="headerlink" title="基本設定"></a>基本設定</h4><pre><code>set LogName=myLog.txt</code></pre><p>注意事項如下：</p>
<ol>
<li>注意空白</li>
<li>case insensitive</li>
</ol>
{% codeblock  lang:bat %}
@ECHO off
SET spaceExam=  beginText
SET aBc=Hello
SET Abc=World
ECHO %spaceExam%
ECHO %aBc% 
PAUSE
{% endcodeblock %}

<h4 id="輸入提示"><a href="#輸入提示" class="headerlink" title="輸入提示"></a>輸入提示</h4><p>加上<code>/p</code></p>
{% codeblock  lang:bat %}
@ECHO off 
SET /p LogName=請輸入Log檔案名稱 
ECHO Hello World >%LogName% 
PAUSE
{% endcodeblock %}


<h4 id="運算式"><a href="#運算式" class="headerlink" title="運算式"></a>運算式</h4><p>加上<code>/a</code></p>
{% codeblock  lang:bat %}
@ECHO off
SET /p num=Input Number
SET /p price=Input Price
SET /a sum=%num% * %price%
ECHO Sum=%sum%
PAUSE
{% endcodeblock %}

<h3 id="取得變數"><a href="#取得變數" class="headerlink" title="取得變數"></a>取得變數</h3><p>前後加上%</p>
<pre><code>ECHO %LogName%</code></pre><h3 id="常用變數"><a href="#常用變數" class="headerlink" title="常用變數"></a>常用變數</h3><pre><code>%CD% :當前工作目錄
%DATE% :目前系統日期
%TIME% :目前系統時間
%SystemDrive% :系統碟
%ProgramFiles% :應用程式目錄
%ProgramFiles(x86)% :應用程式目錄(x86)</code></pre><h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><p>直接參考 <code>if/?</code>說明</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">在批次檔中執行條件處理。</span><br><span class="line"></span><br><span class="line"><span class="keyword">IF</span> [<span class="keyword">NOT</span>] <span class="keyword">ERRORLEVEL</span> number command</span><br><span class="line"><span class="keyword">IF</span> [<span class="keyword">NOT</span>] string1==string2 command</span><br><span class="line"><span class="keyword">IF</span> [<span class="keyword">NOT</span>] <span class="keyword">EXIST</span> filename command</span><br><span class="line"></span><br><span class="line">  <span class="keyword">NOT</span>               表示 Windows 應該只有在條件為偽時才執行命令。</span><br><span class="line"></span><br><span class="line">  <span class="keyword">ERRORLEVEL</span> number 當上一個執行的程式傳回的結束代碼大於或等於指定</span><br><span class="line">                    數字時，則條件為真。</span><br><span class="line"></span><br><span class="line">  string1==string2  當指定的文字字串相符合時，則條件為真。</span><br><span class="line"></span><br><span class="line">  <span class="keyword">EXIST</span> filename    如果指定的檔名存在時，則條件為真。</span><br><span class="line"></span><br><span class="line">  command           指定當條件為真時所要執行的命令。命令之後可以</span><br><span class="line">                    接著 <span class="keyword">ELSE</span> 命令。當指定條件為偽時，緊接在 <span class="keyword">ELSE</span></span><br><span class="line">                    命令之後的命令將會被執行。</span><br><span class="line"></span><br><span class="line"><span class="keyword">ELSE</span> 子句必須出現在 <span class="keyword">IF</span> 之後的同一行。例如:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">IF</span> <span class="keyword">EXIST</span> filename. (</span><br><span class="line">        <span class="built_in">del</span> filename.</span><br><span class="line">    ) <span class="keyword">ELSE</span> (</span><br><span class="line">        <span class="built_in">echo</span> filename. missing.</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">以下命令無法作用，因為 <span class="built_in">del</span> 命令必須以換行字元來結尾:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">IF</span> <span class="keyword">EXIST</span> filename. <span class="built_in">del</span> filename. <span class="keyword">ELSE</span> <span class="built_in">echo</span> filename. missing</span><br><span class="line"></span><br><span class="line">下面命令也無法作用，因為 <span class="keyword">ELSE</span> 命令必須在與 <span class="keyword">IF</span> 命令同一行的結尾:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">IF</span> <span class="keyword">EXIST</span> filename. <span class="built_in">del</span> filename.</span><br><span class="line">    <span class="keyword">ELSE</span> <span class="built_in">echo</span> filename. missing</span><br><span class="line"></span><br><span class="line">下面命令只有在寫成一行時才能作用:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">IF</span> <span class="keyword">EXIST</span> filename. (<span class="built_in">del</span> filename.) <span class="keyword">ELSE</span> <span class="built_in">echo</span> filename. missing</span><br><span class="line"></span><br><span class="line">(<span class="built_in">more</span>)...</span><br></pre></td></tr></table></figure>

<p>範例：</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">ECHO</span> off</span><br><span class="line"><span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXIST</span> testFolder ( </span><br><span class="line">     <span class="built_in">mkdir</span> testFolder</span><br><span class="line">) <span class="keyword">ELSE</span> ( </span><br><span class="line">     <span class="built_in">ECHO</span> testFolder has been <span class="keyword">exist</span> </span><br><span class="line">) </span><br><span class="line"><span class="built_in">PAUSE</span></span><br></pre></td></tr></table></figure>


<h2 id="導向"><a href="#導向" class="headerlink" title="導向"></a>導向</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Standard Output 代號 1</span><br><span class="line">Standard Error  代號 2</span><br><span class="line">Do Nothing      代號 NUL</span><br><span class="line">Console</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; NUL :將Standard Output導向null</span><br><span class="line">2 &gt; NUL :將Standard Error導向null</span><br><span class="line">&gt; NUL 2&gt;&amp;1 :同時將Standard Output和Standard Error導向null</span><br><span class="line">&gt; log.txt 2&gt;&amp;1 :同時將Standard Output和Standard Error導向File(log.txt)</span><br><span class="line">&gt; log_stdout.txt 2&gt;log_stderr.txt :將Standard Output導向至log_stdout.txt以及將Standard Error導向至log_stderr.txt</span><br></pre></td></tr></table></figure>

<h2 id="常用範例"><a href="#常用範例" class="headerlink" title="常用範例"></a>常用範例</h2><h3 id="判斷指令是否存在"><a href="#判斷指令是否存在" class="headerlink" title="判斷指令是否存在"></a>判斷指令是否存在</h3><p><a href="http://superuser.com/questions/175466/determine-if-command-is-recognized-in-a-batch-file" target="_blank" rel="noopener">Determine if command is recognized in a batch file</a></p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">ECHO</span> off</span><br><span class="line">WHERE mycommand <span class="number">2</span>&gt;<span class="built_in">NUL</span></span><br><span class="line"><span class="keyword">IF</span> <span class="variable">%ERRORLEVEL%</span> <span class="keyword">NEQ</span> <span class="number">0</span> (</span><br><span class="line">     <span class="built_in">ECHO</span> mycommand wasn't found </span><br><span class="line">)  <span class="keyword">ELSE</span> ( </span><br><span class="line">     <span class="built_in">ECHO</span> mycommand found </span><br><span class="line">)</span><br><span class="line"><span class="built_in">PAUSE</span></span><br></pre></td></tr></table></figure>

<h3 id="判斷檔案是否存在"><a href="#判斷檔案是否存在" class="headerlink" title="判斷檔案是否存在"></a>判斷檔案是否存在</h3><p>檢查7z.exe是否存在</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">ECHO</span> off</span><br><span class="line"><span class="built_in">SET</span> filepath=<span class="variable">%ProgramFiles%</span>\<span class="number">7</span>-Zip\</span><br><span class="line"><span class="built_in">SET</span> filename=<span class="number">7</span>z.exe</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">%filepath%</span></span><br><span class="line"><span class="keyword">IF</span> <span class="keyword">EXIST</span> <span class="variable">%filename%</span> (</span><br><span class="line">	<span class="built_in">ECHO</span> <span class="variable">%filename%</span>  found</span><br><span class="line">	<span class="built_in">ECHO</span> <span class="variable">%CD%</span></span><br><span class="line">)  <span class="keyword">ELSE</span> ( </span><br><span class="line">    <span class="built_in">ECHO</span> <span class="variable">%filename%</span> wasn't found </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">:: BAT File所在位置 %~dp0</span><br><span class="line"><span class="built_in">cd</span> %~dp0</span><br><span class="line"><span class="built_in">ECHO</span> <span class="variable">%CD%</span></span><br><span class="line"><span class="built_in">PAUSE</span></span><br></pre></td></tr></table></figure>

<h3 id="日期與時間變數"><a href="#日期與時間變數" class="headerlink" title="日期與時間變數"></a>日期與時間變數</h3><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">::民國年</span><br><span class="line"><span class="built_in">set</span> /a year=<span class="variable">%date:~,4%</span>-<span class="number">1911</span></span><br><span class="line">::西元年</span><br><span class="line"><span class="built_in">set</span> year=<span class="variable">%date:~,4%</span></span><br><span class="line">::月</span><br><span class="line"><span class="built_in">set</span> month=<span class="variable">%date:~5,2%</span></span><br><span class="line">::日</span><br><span class="line"><span class="built_in">set</span> day=<span class="variable">%date:~8,2%</span></span><br><span class="line">::今天日期</span><br><span class="line"><span class="built_in">set</span> Today=<span class="variable">%year%</span><span class="variable">%month%</span><span class="variable">%day%</span></span><br><span class="line">::時間</span><br><span class="line"><span class="built_in">set</span> NowTimeTmp=<span class="variable">%time::=%</span></span><br><span class="line"><span class="built_in">set</span> NowTime=<span class="variable">%NowTimeTmp:~0,6%</span></span><br></pre></td></tr></table></figure>

<h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><ul>
<li><a href="https://www.gitbook.com/book/peterju/cmddoc/details" target="_blank" rel="noopener">批次檔的精要學習手冊</a></li>
<li><a href="http://www.tinysoftwares.in/BatchFileTutorial/Index" target="_blank" rel="noopener">Batch File Basic Tutorial</a></li>
<li><a href="http://www.robvanderwoude.com/battech_redirection.php" target="_blank" rel="noopener">Display &amp; Redirect Output</a></li>
<li><a href="http://forum.twbts.com/viewthread.php?tid=10152" target="_blank" rel="noopener">批次檔BAT中應用Windows的36個環境變數</a></li>
<li><a href="http://inpega.blogspot.tw/2012/07/cd-dp0.html" target="_blank" rel="noopener">%CD% 與 %~dp0</a></li>
</ul>
</div><!-- comment system--><div class="container"><hr><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'j2hongminggithubio';
var disqus_identifier = '2016/07/28/windows-batch-file-notes/';
var disqus_title = 'Windows Batch File Notes';
var disqus_url = 'http://yoursite.com/2016/07/28/windows-batch-file-notes/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="http://twitter.com/j2hongming" target="_blank"><i class="fa fa-twitter"></i></a><a href="https://github.com/j2hongming" target="_blank"><i class="fa fa-github"></i></a><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2020 <a href="/" rel="nofollow">J2hongming</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-55818738-1');ga('send','pageview');</script></html>