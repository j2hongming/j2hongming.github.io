<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Bat | J2hongming Blog]]></title>
  <link href="http://j2hongming.github.io/blog/categories/bat/atom.xml" rel="self"/>
  <link href="http://j2hongming.github.io/"/>
  <updated>2016-11-07T21:36:49+08:00</updated>
  <id>http://j2hongming.github.io/</id>
  <author>
    <name><![CDATA[HongMing ChangChine]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Windows Batch File Notes]]></title>
    <link href="http://j2hongming.github.io/blog/2016/07/28/windows-batch-file-notes/"/>
    <updated>2016-07-28T16:34:39+08:00</updated>
    <id>http://j2hongming.github.io/blog/2016/07/28/windows-batch-file-notes</id>
    <content type="html"><![CDATA[<ul>
<li>變數</li>
<li>if</li>
<li>導向</li>
<li>常用範例</li>
<li>參考資料</li>
</ul>


<!-- more -->


<h2>變數</h2>

<h3>系統變數</h3>

<pre><code>:: 觀察作業系統環境變數
set
:: 將作業系統環境變數輸出至variables.txt
set &gt; variables.txt
</code></pre>

<h3>設定變數</h3>

<h4>基本設定</h4>

<pre><code>set LogName=myLog.txt
</code></pre>

<p>注意事項如下：</p>

<ol>
<li>注意空白</li>
<li>case insensitive</li>
</ol>


<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="p">@</span><span class="k">ECHO</span> <span class="k">off</span>
</span><span class='line'><span class="k">SET</span> <span class="nv">spaceExam</span><span class="o">=</span>  beginText
</span><span class='line'><span class="k">SET</span> <span class="nv">aBc</span><span class="o">=</span>Hello
</span><span class='line'><span class="k">SET</span> <span class="nv">Abc</span><span class="o">=</span>World
</span><span class='line'><span class="k">ECHO</span> <span class="nv">%spaceExam%</span>
</span><span class='line'><span class="k">ECHO</span> <span class="nv">%aBc%</span>
</span><span class='line'><span class="k">PAUSE</span>
</span></code></pre></td></tr></table></div></figure></p>

<h4>輸入提示</h4>

<p>加上<code>/p</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="p">@</span><span class="k">ECHO</span> <span class="k">off</span>
</span><span class='line'><span class="k">SET</span> <span class="n">/p</span> LogName<span class="o">=</span>請輸入Log檔案名稱
</span><span class='line'><span class="k">ECHO</span> Hello World &gt;<span class="nv">%LogName%</span>
</span><span class='line'><span class="k">PAUSE</span>
</span></code></pre></td></tr></table></div></figure></p>

<h4>運算式</h4>

<p>加上<code>/a</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="p">@</span><span class="k">ECHO</span> <span class="k">off</span>
</span><span class='line'><span class="k">SET</span> <span class="n">/p</span> num<span class="o">=</span>Input Number
</span><span class='line'><span class="k">SET</span> <span class="n">/p</span> price<span class="o">=</span>Input Price
</span><span class='line'><span class="k">SET</span> <span class="n">/a</span> sum<span class="o">=</span><span class="nv">%num%</span> * <span class="nv">%price%</span>
</span><span class='line'><span class="k">ECHO</span> Sum<span class="o">=</span><span class="nv">%sum%</span>
</span><span class='line'><span class="k">PAUSE</span>
</span></code></pre></td></tr></table></div></figure></p>

<h3>取得變數</h3>

<p>前後加上%</p>

<pre><code>ECHO %LogName%
</code></pre>

<h3>常用變數</h3>

<pre><code>%CD% :當前工作目錄
%DATE% :目前系統日期
%TIME% :目前系統時間
%SystemDrive% :系統碟
%ProgramFiles% :應用程式目錄
%ProgramFiles(x86)% :應用程式目錄(x86)
</code></pre>

<h2>if</h2>

<p>直接參考 <code>if/?</code>說明</p>

<pre><code class="bat">在批次檔中執行條件處理。

IF [NOT] ERRORLEVEL number command
IF [NOT] string1==string2 command
IF [NOT] EXIST filename command

  NOT               表示 Windows 應該只有在條件為偽時才執行命令。

  ERRORLEVEL number 當上一個執行的程式傳回的結束代碼大於或等於指定
                    數字時，則條件為真。

  string1==string2  當指定的文字字串相符合時，則條件為真。

  EXIST filename    如果指定的檔名存在時，則條件為真。

  command           指定當條件為真時所要執行的命令。命令之後可以
                    接著 ELSE 命令。當指定條件為偽時，緊接在 ELSE
                    命令之後的命令將會被執行。

ELSE 子句必須出現在 IF 之後的同一行。例如:

    IF EXIST filename. (
        del filename.
    ) ELSE (
        echo filename. missing.
    )

以下命令無法作用，因為 del 命令必須以換行字元來結尾:

    IF EXIST filename. del filename. ELSE echo filename. missing

下面命令也無法作用，因為 ELSE 命令必須在與 IF 命令同一行的結尾:

    IF EXIST filename. del filename.
    ELSE echo filename. missing

下面命令只有在寫成一行時才能作用:

    IF EXIST filename. (del filename.) ELSE echo filename. missing

(more)...
</code></pre>

<p>範例：</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bat'><span class='line'><span class="p">@</span><span class="k">ECHO</span> <span class="k">off</span>
</span><span class='line'><span class="k">IF</span> NOT <span class="k">EXIST</span> testFolder (
</span><span class='line'>     mkdir testFolder
</span><span class='line'>) <span class="k">ELSE</span> (
</span><span class='line'>     <span class="k">ECHO</span> testFolder has been <span class="k">exist</span>
</span><span class='line'>)
</span><span class='line'><span class="k">PAUSE</span>
</span></code></pre></td></tr></table></div></figure></p>

<h2>導向</h2>

<pre><code>Standard Output 代號 1
Standard Error  代號 2
Do Nothing      代號 NUL
Console
</code></pre>

<pre><code>&gt; NUL :將Standard Output導向null
2 &gt; NUL :將Standard Error導向null
&gt; NUL 2&gt;&amp;1 :同時將Standard Output和Standard Error導向null
&gt; log.txt 2&gt;&amp;1 :同時將Standard Output和Standard Error導向File(log.txt)
&gt; log_stdout.txt 2&gt;log_stderr.txt :將Standard Output導向至log_stdout.txt以及將Standard Error導向至log_stderr.txt
</code></pre>

<h2>常用範例</h2>

<h3>判斷指令是否存在</h3>

<p><a href="http://superuser.com/questions/175466/determine-if-command-is-recognized-in-a-batch-file">Determine if command is recognized in a batch file</a></p>

<pre><code class="bat">@ECHO off
WHERE mycommand 2&gt;NUL
IF %ERRORLEVEL% NEQ 0 (
     ECHO mycommand wasn't found 
)  ELSE ( 
     ECHO mycommand found 
)
PAUSE
</code></pre>

<h3>判斷檔案是否存在</h3>

<p>檢查7z.exe是否存在</p>

<pre><code class="bat">@ECHO off
SET filepath=%ProgramFiles%\7-Zip\
SET filename=7z.exe

cd %filepath%
IF EXIST %filename% (
    ECHO %filename%  found
    ECHO %CD%
)  ELSE ( 
    ECHO %filename% wasn't found 
)

:: BAT File所在位置 %~dp0
cd %~dp0
ECHO %CD%
PAUSE
</code></pre>

<h3>日期與時間變數</h3>

<pre><code class="bat">::民國年
set /a year=%date:~,4%-1911
::西元年
set year=%date:~,4%
::月
set month=%date:~5,2%
::日
set day=%date:~8,2%
::今天日期
set Today=%year%%month%%day%
::時間
set NowTimeTmp=%time::=%
set NowTime=%NowTimeTmp:~0,6%
</code></pre>

<h2>參考資料</h2>

<ul>
<li><a href="https://www.gitbook.com/book/peterju/cmddoc/details">批次檔的精要學習手冊</a></li>
<li><a href="http://www.tinysoftwares.in/BatchFileTutorial/Index">Batch File Basic Tutorial</a></li>
<li><a href="http://www.robvanderwoude.com/battech_redirection.php">Display &amp; Redirect Output</a></li>
<li><a href="http://forum.twbts.com/viewthread.php?tid=10152">批次檔BAT中應用Windows的36個環境變數</a></li>
<li><a href="http://inpega.blogspot.tw/2012/07/cd-dp0.html">%CD% 與 %~dp0</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
